(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{320:function(e,t,n){},338:function(e,t,n){"use strict";var i=n(320);n.n(i).a},349:function(e,t,n){"use strict";n.r(t);n(166);var i,r,o,a,c=n(325),s=n.n(c);n(334);function u(e){if(!e)throw new Error("没有指定画布对象");this.useSpeechStream=function(e){!function(e){if(!e)throw new Error("媒体流不能为空");t.createMediaStreamSource(e).connect(n),n.connect(r),r.connect(t.destination),r.gain.setValueAtTime(0,t.currentTime)}(e)},this.setVisualize=function(e){!function(e){switch(window.cancelAnimationFrame(i),e){case"sinewave":!function(){n.fftSize=2048;var e=n.frequencyBinCount,t=new Uint8Array(e);a.clearRect(0,0,c,s),function r(){i=requestAnimationFrame(r),n.getByteTimeDomainData(t),a.fillStyle="rgb(255, 255, 255)",a.fillRect(0,0,c,s),a.lineWidth=2,a.strokeStyle="wheat",a.beginPath();for(var u=1*c/e,l=0,d=0;d<e;d++){var f=t[d]/128*s/2;0===d?a.moveTo(l,f):a.lineTo(l,f),l+=u}a.lineTo(o.width,o.height/2),a.stroke()}()}();break;case"frequencybars":!function(){n.fftSize=256;var e=n.frequencyBinCount,t=new Uint8Array(e);a.clearRect(0,0,c,s),function r(){i=requestAnimationFrame(r),n.getByteFrequencyData(t),a.fillStyle="rgb(246, 249, 248)",a.fillRect(0,0,c,s);for(var o,u=c/e*2.5,l=10,d=0;d<e;d++)o=t[d],a.fillStyle="rgb("+(o+140)+",50,50)",a.fillRect(l,s-o/2,u,o/2),l+=u+1}()}();break;case"off":a.clearRect(0,0,c,s),a.fillStyle="white",a.fillRect(0,0,c,s);break;default:throw new Error("没有匹配值")}}(e)};var t=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext),n=t.createAnalyser();n.minDecibels=-90,n.maxDecibels=-10,n.smoothingTimeConstant=.85;var i,r=t.createGain(),o=document.querySelector(e),a=o.getContext("2d");var c=o.width,s=o.height}var l=!0,d=!0,f={recorderType:s.a.StereoAudioRecorder,desiredSampRate:16e3,numberOfAudioChannels:1,disableLogs:d};function h(){return new Promise((function(e,t){new Promise((function(e,t){navigator.mediaDevices.getUserMedia({audio:!0}).then((function(t){return e(t)})).catch((function(e){t(e)}))})).then((function(t){(i=s()(t,f)).microphone=t,e(t)})).catch((function(e){return t(e)}))}))}var m={name:"SpeechRecorderWav",data:function(){return{audioData:"",recordBtuName:"开始",isDebug:!0}},mounted:function(){o="#canvasEl"},methods:{handleRecord:function(){"开始"===this.recordBtuName?(this.recordBtuName="结束",this.startRecording()):(this.recordBtuName="开始",this.stopRecording())},startRecording:function(){var e,t=this;(e=this.isDebug,o&&l&&(l=!1,a=new u(o)),new Promise((function(t,n){if(i&&"recording"===i.state)return n("请先结束当前录制");d=e,h().then((function(e){a&&a.useSpeechStream(e),a&&a.setVisualize("sinewave"),t(e),i.startRecording(),r=(new Date).getTime()})).catch((function(e){return n(e)}))}))).then((function(e){console.log(e)})).catch((function(e){"请先结束当前录制"===e?t.$message.error(e):t.$message.error("没有录音权限")}))},stopRecording:function(){var e=this;new Promise((function(e,t){return"stopped"===i.state?t("请先开始录制"):(r=(new Date).getTime()-r,a&&a.setVisualize("sinewave"),i.microphone.stop(),r<1200?t("请先开始录制"):void i.stopRecording((function(){i.getDataURL((function(t){var n=t.split(",")[1];e({base64:n,dataUrl:t})}))})))})).then((function(t){e.audioData=t.dataUrl})).catch((function(t){e.$message.error(t)}))},saveAudio:function(){i.save()}}},w=(n(338),n(1)),v=Object(w.a)(m,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("br"),e._v(" "),n("speech-wave",{attrs:{"audio-file":e.audioData}}),e._v(" "),n("hr"),e._v(" "),n("el-card",[n("canvas",{staticStyle:{width:"100%",height:"100px"},attrs:{id:"canvasEl"}})]),e._v(" "),n("div",{staticClass:"btn"},[n("el-button",{attrs:{type:"primary",size:"small",round:"",plain:""},on:{click:e.handleRecord}},[e._v(e._s(e.recordBtuName))]),e._v(" "),n("el-button",{attrs:{icon:"el-icon-download",size:"small",round:"",plain:""},on:{click:e.saveAudio}},[e._v("下载")])],1)],1)}),[],!1,null,null,null);t.default=v.exports}}]);