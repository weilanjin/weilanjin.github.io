(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{324:function(t,e,a){},344:function(t,e,a){"use strict";var i=a(324);a.n(i).a},350:function(t,e,a){"use strict";a.r(e);a(166),a(15),a(42);var i=a(343),n=a.n(i),o=a(325),r=a.n(o);function s(t,e,a){var i,o,s,c,d,h,u,l,m,f=this;if(!t)throw"传参错误";function p(){return(new Date).getTime()+""+Math.floor(1e4*Math.random())}function v(){var e=p(),i='<video id="'+e+'" style="display:none"></video>';n()("#"+t).append(i);var o=n()("#"+e);return o.css("width",l),o.css("height",m),a&&o.css("object-fit","fill"),o[0].muted=!0,o}void 0!==a&&null!=a||(a=!0),e=!!e,this.startRecording=function(){f.renovateCamera(),i&&i.startRecording()},this.stopRecording=function(t,e){i&&i.stopRecording((function(){void 0===e&&(e=!0);var a=i.getBlob();!0===e&&(c[0].src=URL.createObjectURL(a),c[0].load(),c.show(),s.hide(),d.hide()),function(t,e){var a=new FileReader;a.onload=function(){var t=a.result.split(",")[1];e(t)},a.readAsDataURL(t)}(a,t)}))},this.destroy=function(e){if(o){var a=s[0];if("srcObject"in a?a.srcObject=null:a.src=null,!e)d[0].getContext("2d").clearRect(0,0,n()("#"+t).width(),n()("#"+t).height());o.getVideoTracks().concat(o.getAudioTracks()).forEach((function(t){t.stop(),o.removeTrack(t)}))}},this.snapPhoto=function(t,e,a){if(d){var i=d[0],n=s[0];if(!i||"function"!=typeof i.getContext)return f.onError({msg:"canvas not ready!"}),void("function"==typeof t&&t(null));void 0===e&&(e=!0),!0===e&&(s.hide(),c.hide(),d.show());var o=i.getContext("2d");if("fill"===s.css("object-fit"))o.drawImage(n,0,0,l,m);else{var r=0,p=0;l>h&&(r=(l-h)/2),m>u&&(p=(m-u)/2),o.drawImage(n,r,p,h,u)}"function"==typeof t&&t(f.getCanvasBase64(a))}},this.getCanvasBase64=function(e){if(d){var a=d[0];return e?function(e,a,i,o,r){var s,c=p(),d=e.getContext("2d").getImageData(a,i,o,r),h='<canvas id="'+c+'" style="display:none"></canvas>';n()("#"+t).append(h);var u=n()("#"+c);if(u.attr("width",o),u.attr("height",r),!(e=u[0])||"function"!=typeof e.getContext)return f.onError({msg:"canvas not ready!"}),null;return e.getContext("2d").putImageData(d,0,0,0,0,o,r),s=e.toDataURL().split(",")[1],u.remove(),s}(a,e.x,e.y,e.width,e.height):a.toDataURL().split(",")[1]}},this.renovateCamera=function(){d&&(s.show(),c.hide(),d.hide())},this.ready=function(a){if(!0===g&&(g=!1,n()("#"+t).empty(),l=n()("#"+t).width(),m=n()("#"+t).height(),(s=v().show()).attr("autoplay","autoplay"),(c=v().hide()).attr("controls","controls"),d=function(){var e=p(),a='<canvas id="'+e+'" style="display:none"></canvas>';n()("#"+t).append(a);var i=n()("#"+e);return i.attr("width",l),i.attr("height",m),i}().hide()),!0!==function(){var t=!1;return o&&o.getVideoTracks().forEach((function(e){"live"===e.readyState&&(t=!0)})),t}()){var y={audio:e,video:{facingMode:"user",width:960,height:640}};navigator.mediaDevices.getUserMedia(y).then((function(t){(function(t){var e=s[0];"srcObject"in e?e.srcObject=t:e.src=window.URL&&window.URL.createObjectURL(t)||t;e.onloadedmetadata=function(){var t=e.videoWidth,a=e.videoHeight;l/m>t/a?(u=m,h=Math.floor(m*(1*t/a))):(h=l,u=Math.floor(l*(1*a/t)))},i=r()(t,{mimeType:"video/webm"})})(o=t),a()})).catch((function(t){!function(t){f.onError(t)}(t)}))}else a()},this.onError=function(){};var g=!0}var c={name:"VideoRecorder",data:function(){return{media:null,isOpenCamera:!1,isRecord:!1,openCameraLoading:!1,btnName:{optCamera:"打开相机",optRecord:"录像"},file:[]}},mounted:function(){var t=this;this.media=new s("camera-box"),this.media.onError=function(){t.$message.error("没有相机权限")}},methods:{optCameraFn:function(){this.isOpenCamera?(this.btnName.optCamera="打开相机",this.destroy()):(this.btnName.optCamera="关闭相机",this.openCamera())},optRecordVideo:function(){this.isOpenCamera||this.$message.error("请开启相机！"),this.isRecord?(this.isRecord=!1,this.btnName.optRecord="录像",this.stopRecording()):(this.isRecord=!0,this.btnName.optRecord="停止",this.startRecording())},openCamera:function(){var t=this;this.openCameraLoading=!0,this.media.ready((function(){t.openCameraLoading=!1,t.isOpenCamera=!0}))},selectCamera:function(t){this.media.selectCamera(t)},snapphoto:function(){var t=this;this.isOpenCamera||this.$message.error("请开启相机！"),this.media.snapPhoto((function(e){t.file.push({type:"img",url:"data:image/png;base64,"+e})}),!1)},startRecording:function(){this.media.startRecording()},stopRecording:function(){var t=this;this.media.stopRecording((function(e){t.file.push({type:"video",url:"data:video/webm;base64,"+e})}),!1)},renovateCamera:function(){this.media.renovateCamera()},destroy:function(){this.media.destroy(),this.isOpenCamera=!1}},destroyed:function(){this.destroy()}},d=(a(344),a(1)),h=Object(d.a)(c,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"video-recorder"},[a("div",{staticClass:"camera-box",attrs:{id:"camera-box"}}),t._v(" "),a("div",{staticClass:"opt-btn"},[a("el-button",{attrs:{loading:t.openCameraLoading,size:"small",type:"primary"},on:{click:t.optCameraFn}},[t._v(t._s(t.btnName.optCamera))]),t._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.snapphoto}},[t._v("拍照")]),t._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.optRecordVideo}},[t._v(t._s(t.btnName.optRecord))])],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.file.length>0,expression:"file.length>0"}]},[a("el-carousel",{attrs:{interval:4e3,type:"card",height:"200px"}},t._l(t.file,(function(t,e){return a("el-carousel-item",{key:e},["img"===t.type?a("img",{attrs:{src:t.url}}):a("video",{attrs:{width:"307px",height:"206px",controls:"",src:t.url}})])})),1)],1)])}),[],!1,null,"df048d88",null);e.default=h.exports}}]);